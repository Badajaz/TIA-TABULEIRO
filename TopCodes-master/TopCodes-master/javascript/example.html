<!DOCTYPE html>
<html>
<head>
  <title>TopCodes Example</title>
</head>

<body>
  <canvas id="video-canvas" width="1200" height="500" style="background: #ddd;"></canvas>
  <br/>
  <button id="camera-button" onclick="TopCodes.startStopVideoScan('video-canvas')">Start / Stop</button>

  <script src="topcodes.js"></script>
  
  <p id="demo"></p>
  <p id="demo2"></p>
  <p id="demo3"></p>
 
  <script>

  TopCodes.setVideoFrameCallback("video-canvas", function(jsonString) {
    var json = JSON.parse(jsonString);
	var arrayTopcodes = json.topcodes;
	drawCodes(json.topcodes);
	var codes = arrayTopcodes.map(function(item) {
		var dimensoes = [];
		var direcoes = [];
		var array = [];
			
		if(item.code == 157 ){
			array.push(item.code);
			array.push(item.x);
			array.push(item.y);
			array.push("inf-esq");
			dimensoes += [item.code,item.x,item.y,"inf-esq"];
			direcoes+=["inf-esq"]
		 }
		 
		 if(item.code == 31 ){
			array.push(item.code);
			array.push(item.x);
			array.push(item.y);
			array.push("sup-esq");
			dimensoes += [item.code,item.x,item.y,"sup-esq"];
			direcoes+=["sup-esq"];
		 }
		 
		 if(item.code == 205 ){
			array.push(item.code);
			array.push(item.x);
			array.push(item.y);
			array.push("sup-dir");
			dimensoes += [item.code,item.x,item.y,"sup-dir"];       
			direcoes+=["sup-dir"];
		 }
		 
		 if(item.code == 103 ){
			array.push(item.code);
			array.push(item.x);
			array.push(item.y);
			array.push("inf-dir");
			dimensoes += [item.code,item.x,item.y,"inf-dir"];
			direcoes+=["inf-dir"]
		 }
		 
		 
 		 if(item.code == 47 ){
			array.push(item.code);
			array.push(item.x);
			array.push(item.y);
			array.push("cima");
			dimensoes += [item.code,item.x,item.y,"cima"];
			direcoes+=["cima"];
		 }
		 
		 if(item.code == 107){
		 
			array.push(item.code);
			array.push(item.x);
			array.push(item.y);
			array.push("direita");
			dimensoes += [item.code,item.x,item.y,"direita"];
			direcoes+=["direita"];
		 }	
		 

		return array;
	});
	
	var flatArray = codes.reduce((acc, val) => acc.concat(val), []);
	
	document.getElementById("demo").innerHTML =  flatArray;
	document.getElementById("demo2").innerHTML =  flatArray.length;
	document.getElementById("demo3").innerHTML =  getInfEsqCoordinates(flatArray);
	
	
	
	
});


  function drawCodes(topcodes) {
    var ctx = document.querySelector("#video-canvas").getContext('2d');
    ctx.fillStyle = "rgba(255, 0, 0, 0.3)";
    for (var 	i=0; i<topcodes.length; i++) {
      ctx.beginPath();
      ctx.arc(topcodes[i].x, topcodes[i].y, topcodes[i].radius, 0, Math.PI*2, true);
      ctx.fill();
    }
  }
  
  
  function getInfEsqCoordinates(flatArray){
	var infesq = [];
	for (var i = 0; i < flatArray.length; i+=4) {
		
		if(flatArray[i] == 157){
			infesq.push(flatArray[i+1]);
			infesq.push(flatArray[i+2]);
		}
	}

		
	return infesq;
  }
  
  
    function getSupEsqCoordinates(flatArray){
	var supesq = [];
	for (var i = 0; i < flatArray.length; i+=4) {
		
		if(flatArray[i] == 157){
			supesq.push(flatArray[i+1]);
			supesq.push(flatArray[i+2]);
		}
	}

		
	return supesq;
  }
  
  
    function getInfDirCoordinates(flatArray){
	var infdir = [];
	for (var i = 0; i < flatArray.length; i+=4) {
		
		if(flatArray[i] == 103){
			infdir.push(flatArray[i+1]);
			infdir.push(flatArray[i+2]);
		}
	}

		
	return infdir;
  }
  
  
    function getSupDirCoordinates(flatArray){
	var supdir = [];
	for (var i = 0; i < flatArray.length; i+=4) {
		
		if(flatArray[i] == 205){
			supdir.push(flatArray[i+1]);
			supdir.push(flatArray[i+2]);
		}
	}

		
	return supdir;
  }


  </script>
</body>
</html>
